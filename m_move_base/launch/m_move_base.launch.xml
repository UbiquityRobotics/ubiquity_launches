<launch>
  <!--Summary: Starts the `move_base` navigation system for a robot. -->
  <!--Overview: Start the `move_base` navigation system for the currently
        selected robot. -->

  <!-- Required Arguments: -->
  <arg name="robot_platform" />
  <arg name="robot_host" />
  <arg name="robot_user" />
  <arg name="viewer_host" default="localhost"/>
  <arg name="viewer_user" default=""/>

  <!-- Convenience Arguments: -->
  <arg name="ul" value="$(find ubiquity_launches)" />
  <arg name="nvs" value="navigation_velocity_smoother" />

  <!-- Optional arguments: -->
  <!-- Name of the map to use (without path nor extension) and initial position -->
  <arg name="map_file" default="$(arg ul)/m_robot_base/maps/stage/maze.world"/>
    <!--map_file: The stage `.world` file to use. -->
  <arg name="initial_pose_x" default="2.0"/>
    <!--initial_pose_x: Initial X position of robot in simultion. -->
  <arg name="initial_pose_y" default="2.0"/>
    <!--initial_pose_y: Initial Y position of robot in simultion. -->
  <arg name="initial_pose_a" default="0.0"/>
    <!--initial_pose_a: Initial angular position of robot in simultion (radians). -->

  <!-- Start the robot base: -->
  <include file="$(arg ul)/m_robot_base/launch/m_robot_base.launch.xml">
    <arg name="robot_platform" value="$(arg robot_platform)" />
    <arg name="robot_host" value="$(arg robot_host)" />
    <arg name="robot_user" value="$(arg robot_user)" />
    <arg name="viewer_host" value="$(arg viewer_host)"/>
    <arg name="viewer_user" value="$(arg viewer_user)"/>
  </include>

  <include file="$(arg ul)/n_$(arg nvs)/launch/n_$(arg nvs).launch.xml">
    <arg name="robot_platform" value="$(arg robot_platform)" />
    <arg name="machine_name" value="robot" />
    <arg name="machine_host" value="$(arg robot_host)" />
    <arg name="machine_user" value="$(arg robot_user)" />

    <arg name="odometry_stopic" value="/odom"/>
    <arg name="robot_cmd_vel_stopic" value="/mobile_base/commands/velocity"/>
    <arg name="smooth_cmd_vel_ptopic" value="/cmd_vel_mux/input/navi"/>
  </include>

  <node pkg="nodelet" type="nodelet" name="kobuki_safety_controller"
   args="load kobuki_safety_controller/SafetyControllerNodelet /mobile_base_nodelet_manager">
    <remap from="kobuki_safety_controller/cmd_vel" to="/cmd_vel_mux/input/safety_controller"/>
    <remap from="kobuki_safety_controller/events/bumper" to="/mobile_base/events/bumper"/>
    <remap from="kobuki_safety_controller/events/cliff" to="/mobile_base/events/cliff"/>
    <remap from="kobuki_safety_controller/events/wheel_drop" to="/mobile_base/events/wheel_drop"/>
  </node>

  <!-- Start move_base node: -->
  <include file="$(arg ul)/n_move_base/launch/n_move_base.launch.xml">
    <arg name="robot_platform" value="$(arg robot_platform)" />
    <arg name="machine_name" value="robot" />
    <arg name="machine_host" value="$(arg robot_host)" />
    <arg name="machine_user" value="$(arg robot_user)" />
  </include>

  <!-- Start the map server node: -->
  <include file="$(arg ul)/n_map_server/launch/n_map_server.launch.xml">
    <arg name="robot_platform" value="$(arg robot_platform)"/>
    <arg name="machine_name" default="robot"/>
    <arg name="machine_host" value="$(arg robot_host)"/>
    <arg name="machine_user" value="$(arg robot_user)"/>

    <arg name="map_file" value="$(arg ul)/m_robot_base/maps/maze.yaml" />
  </include>

  <!-- Start the AMCL (Adaptive Monte Carlo Localization) system: -->
  <include file="$(arg ul)/n_amcl/launch/n_amcl.launch.xml">
    <arg name="robot_platform" value="$(arg robot_platform)"/>
    <arg name="machine_name" default="robot"/>
    <arg name="machine_host" value="$(arg robot_host)"/>
    <arg name="machine_user" value="$(arg robot_user)"/>

    <arg name="scan_stopic" value="scan" />
    <arg name="use_map_topic" value="true" />
    <arg name="initial_pose_x" value="$(arg initial_pose_x)" />
    <arg name="initial_pose_y" value="$(arg initial_pose_y)" />
    <arg name="initial_pose_a" value="$(arg initial_pose_a)" />
  </include>

</launch>
